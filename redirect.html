<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ç™»å½•å¤„ç†ä¸­...</title>
  <script src="https://alcdn.msauth.net/browser/2.14.2/js/msal-browser.min.js"></script>
</head>
<body>
  <h2>æ­£åœ¨å¤„ç†ç™»å½•ï¼Œè¯·ç¨å€™...</h2>

  <script>
    const msalConfig = {
      auth: {
        clientId: "3de8b2b8-03ac-4a71-a916-d424cd07c84e",  // æ›¿æ¢æˆä½ çš„å®é™… clientId
        authority: "https://login.microsoftonline.com/exidtestyudong.onmicrosoft.com",  // ä½ çš„ç§Ÿæˆ·
        redirectUri: "https://yudongtest.xyz/index.html"  // å¿…é¡»ä¸ Azure ä¸­é…ç½®ä¸€è‡´
      }
    };

    const msalInstance = new msal.PublicClientApplication(msalConfig);

    msalInstance.handleRedirectPromise()
      .then(response => {
        if (response) {
          const account = response.account;
          console.log("ç™»å½•æˆåŠŸï¼Œç”¨æˆ·ï¼š", account.username);
          // ğŸ‘‡ è‡ªåŠ¨è·³è½¬åˆ° index.html
          window.location.href = "index.html";
        } else {
          // æ²¡æœ‰è¿”å›ç™»å½•ä¿¡æ¯ï¼ˆå¯èƒ½ç”¨æˆ·å·²ç™»å½•ï¼‰
          const currentAccounts = msalInstance.getAllAccounts();
          if (currentAccounts.length > 0) {
            console.log("ç”¨æˆ·å·²ç™»å½•ï¼š", currentAccounts[0].username);
            window.location.href = "index.html";
          } else {
            alert("æœªæ£€æµ‹åˆ°ç™»å½•çŠ¶æ€ï¼Œè¯·é‡æ–°ç™»å½•ã€‚");
          }
        }
      })
      .catch(error => {
        console.error("ç™»å½•å‡ºé”™ï¼š", error);
        alert("ç™»å½•å¤±è´¥ï¼š" + (error.errorMessage || error.message));
      });
  </script>
</body>
</html>
